"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{40239:function(e,t,n){n.r(t),n.d(t,{PWNetworkGraph:function(){return f}});var l=n(57437),r=n(2265),a=n(75156),o=n(5155),s=n(67188),i=n(46390),u=n(74358),c=n(23870),d=n(43727),h=n(24989);function f(e){var t;let{nodes:n,edges:f,nodeColor:x=h.ZE[0],ariaLabel:g}=e,m=(0,r.useRef)(null),[v,p]=(0,r.useState)({width:600,height:400}),[b,y]=(0,r.useState)([]),[M,k]=(0,r.useState)([]),[w,j]=(0,r.useState)(null),[C,S]=(0,r.useState)(null),[N,E]=(0,r.useState)(null),Z=(0,r.useRef)(null),[R,Y]=(0,r.useState)(1),[D,O]=(0,r.useState)({x:0,y:0}),[W,X]=(0,r.useState)(!1),z=(0,r.useRef)({x:0,y:0,panX:0,panY:0}),[_,q]=(0,r.useState)(!1),F=(0,r.useRef)(!1);(0,r.useEffect)(()=>{let e=m.current;if(!e)return;let t=new ResizeObserver(e=>{let{width:t,height:n}=e[0].contentRect;t>0&&n>0&&p({width:t,height:n})});return t.observe(e),()=>t.disconnect()},[]);let L=n.length,B=Math.max(...n.map(e=>e.patents),1),P=Math.max(...f.map(e=>e.weight),1),T=(0,r.useCallback)(e=>{let t=L>100?18:L>50?22:28,n=L>100?1.5:2.5;return n+(t-n)*Math.sqrt(e/B)},[L,B]),U=(0,r.useCallback)(e=>.15+1.8*Math.sqrt(e/P),[P]),A=(0,r.useMemo)(()=>{let e={};return f.forEach(t=>{e[t.source]=(e[t.source]||0)+1,e[t.target]=(e[t.target]||0)+1}),e},[f]),G=(0,r.useMemo)(()=>Math.max(...Object.values(A),1),[A]),H=(0,r.useCallback)(e=>{var t;return .4+.6*Math.sqrt((null!==(t=A[e])&&void 0!==t?t:0)/G)},[A,G]),I=(0,r.useMemo)(()=>{var e;let t=Object.values(A).sort((e,t)=>t-e),n=Math.min(Math.max(10,Math.floor(.05*t.length)),t.length-1);return null!==(e=t[n])&&void 0!==e?e:1},[A]),J=(0,r.useCallback)(()=>{if(0===b.length)return;let e=1/0,t=-1/0,n=1/0,l=-1/0;b.forEach(r=>{var a,o;let s=T(r.patents),i=null!==(a=r.x)&&void 0!==a?a:0,u=null!==(o=r.y)&&void 0!==o?o:0;e=Math.min(e,i-s),t=Math.max(t,i+s),n=Math.min(n,u-s),l=Math.max(l,u+s)});let r=t-e,a=l-n;if(r<=0||a<=0)return;let o=Math.min((v.width-80)/r,(v.height-80)/a,2),s=(e+t)/2,i=(n+l)/2,u=v.width/2-s*o,c=v.height/2-i*o;Y(o),O({x:u,y:c})},[b,v,T]);(0,r.useEffect)(()=>{_&&!F.current&&b.length>0&&(F.current=!0,J())},[_,b,J]),(0,r.useEffect)(()=>{if(0===n.length)return;q(!1),F.current=!1;let e=n.map(e=>({...e})),t=new Set(e.map(e=>e.id)),l=f.filter(e=>t.has(e.source)&&t.has(e.target)).map(e=>({source:e.source,target:e.target,weight:e.weight})),r=L>100?.08:.06,h=(0,a.Z)(e).force("link",(0,o.Z)(l).id(e=>e.id).distance(L>100?30:L>50?45:60).strength(e=>.4+e.weight/P*.6)).force("charge",(0,s.Z)().strength(L>100?-60:L>50?-100:-150).distanceMax(300)).force("center",(0,i.Z)(0,0).strength(.5)).force("x",(0,u.Z)(0).strength(r)).force("y",(0,c.Z)(0).strength(r)).force("collide",(0,d.Z)().radius(e=>T(e.patents)+.5).strength(.7)).alphaDecay(.02).velocityDecay(.4);Z.current=h;let x=0;return h.on("tick",()=>{let t=performance.now();t-x>66&&(x=t,y([...e]),k([...l]))}),h.on("end",()=>{y([...e]),k([...l]),q(!0)}),()=>{h.stop()}},[n,f]);let K=(0,r.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),E(t.id);let n=Z.current;n&&(n.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y)},[]),Q=(0,r.useCallback)(e=>{if(!N||!Z.current)return;let t=e.target.closest("svg");if(!t)return;let n=t.getBoundingClientRect(),l=e.clientX-n.left,r=e.clientY-n.top,a=(l-D.x)/R,o=(r-D.y)/R,s=b.find(e=>e.id===N);s&&(s.fx=a,s.fy=o)},[N,b,R,D]),V=(0,r.useCallback)(()=>{if(!N)return;let e=Z.current;if(e){e.alphaTarget(0);let t=b.find(e=>e.id===N);t&&(t.fx=null,t.fy=null)}E(null)},[N,b]),$=(0,r.useMemo)(()=>{let e=new Set;return C&&(e.add(C),f.forEach(t=>{t.source===C&&e.add(t.target),t.target===C&&e.add(t.source)})),e},[C,f]),ee=(0,r.useMemo)(()=>{let e=new Set;return C&&f.forEach(t=>{(t.source===C||t.target===C)&&e.add("".concat(t.source,"-").concat(t.target))}),e},[C,f]),et=(0,r.useCallback)(e=>{e.preventDefault();let t=e.target.closest("svg");if(!t)return;let n=t.getBoundingClientRect(),l=e.clientX-n.left,r=e.clientY-n.top,a=e.deltaY>0?.9:1.1;Y(e=>{let t=Math.min(8,Math.max(.05,e*a));return O(n=>({x:l-(l-n.x)*(t/e),y:r-(r-n.y)*(t/e)})),t})},[]),en=(0,r.useCallback)(e=>{e.target.closest("circle")||0!==e.button&&1!==e.button||(e.preventDefault(),X(!0),z.current={x:e.clientX,y:e.clientY,panX:D.x,panY:D.y})},[D]),el=(0,r.useCallback)(e=>{W&&O({x:z.current.panX+(e.clientX-z.current.x),y:z.current.panY+(e.clientY-z.current.y)})},[W]),er=(0,r.useCallback)(()=>{X(!1)},[]);return(0,l.jsxs)("div",{ref:m,className:"relative w-full h-full select-none",children:[(0,l.jsxs)("div",{className:"absolute top-2 right-2 z-20 flex flex-col gap-1",children:[(0,l.jsx)("button",{onClick:()=>{Y(e=>Math.min(8,1.3*e))},className:"w-8 h-8 rounded border bg-card text-foreground flex items-center justify-center hover:bg-muted text-lg font-bold",title:"Zoom in","aria-label":"Zoom in",children:"+"}),(0,l.jsx)("button",{onClick:()=>{Y(e=>Math.max(.05,e/1.3))},className:"w-8 h-8 rounded border bg-card text-foreground flex items-center justify-center hover:bg-muted text-lg font-bold",title:"Zoom out","aria-label":"Zoom out",children:"âˆ’"}),(0,l.jsx)("button",{onClick:J,className:"w-8 h-8 rounded border bg-card text-foreground flex items-center justify-center hover:bg-muted text-xs",title:"Fit to view","aria-label":"Fit to view",children:"Fit"})]}),(0,l.jsx)("svg",{width:v.width,height:v.height,role:"img","aria-label":null!=g?g:"Network graph with ".concat(n.length," nodes and ").concat(f.length," connections"),onWheel:et,onMouseDown:en,onMouseMove:e=>{el(e),Q(e)},onMouseUp:()=>{er(),V()},onMouseLeave:()=>{er(),V(),j(null),S(null)},style:{cursor:W?"move":N?"grabbing":"grab"},children:(0,l.jsxs)("g",{transform:"translate(".concat(D.x,", ").concat(D.y,") scale(").concat(R,")"),children:[M.map((e,t)=>{let n=e.source,r=e.target;if(null==n.x||null==r.x||null==n.y||null==r.y)return null;let a="".concat(n.id,"-").concat(r.id),o=!!C&&ee.has(a),s=C&&!o;return(0,l.jsx)("line",{x1:n.x,y1:n.y,x2:r.x,y2:r.y,stroke:o?x:"hsl(var(--muted-foreground))",strokeWidth:o?1.5*U(e.weight):U(e.weight),strokeOpacity:s?.03:o?.6:.15},"edge-".concat(t))}),b.map(e=>{var t,n,r,a,o,s,i;let u=T(e.patents),c=!C||$.has(e.id),d=C===e.id,h=(null!==(t=A[e.id])&&void 0!==t?t:0)>=I||d||C&&$.has(e.id);return(0,l.jsxs)("g",{children:[d&&(0,l.jsx)("circle",{cx:null!==(n=e.x)&&void 0!==n?n:0,cy:null!==(r=e.y)&&void 0!==r?r:0,r:u+4,fill:"none",stroke:x,strokeWidth:2,strokeOpacity:.4}),(0,l.jsx)("circle",{cx:null!==(a=e.x)&&void 0!==a?a:0,cy:null!==(o=e.y)&&void 0!==o?o:0,r:u,fill:x,fillOpacity:c?H(e.id):.04,stroke:d?"#fff":"none",strokeWidth:d?1.5:0,style:{cursor:"grab"},onMouseDown:t=>K(t,e),onMouseEnter:()=>{if(!N){var t,n;S(e.id),j({x:(null!==(t=e.x)&&void 0!==t?t:0)*R+D.x+u*R+10,y:(null!==(n=e.y)&&void 0!==n?n:0)*R+D.y-10,node:e})}},onMouseLeave:()=>{N||(S(null),j(null))}}),h&&(0,l.jsx)("text",{x:null!==(s=e.x)&&void 0!==s?s:0,y:(null!==(i=e.y)&&void 0!==i?i:0)+u+(d?12:10),textAnchor:"middle",fontSize:d?10:7,fontWeight:d?600:400,fill:"hsl(var(--foreground))",fillOpacity:c?d?1:.7:.08,pointerEvents:"none",style:{textShadow:"0 0 3px hsl(var(--background)), 0 0 3px hsl(var(--background))"},children:e.name.length>24?e.name.slice(0,22)+"...":e.name})]},e.id)})]})}),w&&(0,l.jsxs)("div",{className:"absolute pointer-events-none z-10 rounded-lg border bg-card px-3 py-2 text-sm shadow-md",style:{left:Math.min(w.x,v.width-250),top:Math.max(w.y,10),maxWidth:260},children:[(0,l.jsx)("div",{className:"font-semibold",children:w.node.name}),(0,l.jsxs)("div",{className:"text-muted-foreground text-xs mt-1",children:[w.node.patents.toLocaleString("en-US")," patents"]}),(0,l.jsxs)("div",{className:"text-muted-foreground text-xs",children:[null!==(t=A[w.node.id])&&void 0!==t?t:0," connections"]})]})]})}}}]);