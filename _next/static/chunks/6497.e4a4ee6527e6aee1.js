"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6497],{66497:function(e,t,r){r.r(t),r.d(t,{PWWorldFlowMap:function(){return _}});var o=r(57437),n=r(2265),l=r(32603),a=r(64318);function s(e,t){var r=t*t,o=r*r;return[e*(.8707-.131979*r+o*(-.013791+o*(.003971*r-.001529*o))),t*(1.007226+r*(.015085+o*(-.044475+.028874*r-.005916*o)))]}s.invert=function(e,t){var r,o=t,n=25;do{var l=o*o,s=l*l;o-=r=(o*(1.007226+l*(.015085+s*(-.044475+.028874*l-.005916*s)))-t)/(1.007226+l*(.045255+s*(-.311325+.259866*l-.005916*11*s)))}while((0,a.Wn)(r)>a.Ho&&--n>0);return[e/(.8707+(l=o*o)*(-.131979+l*(-.013791+l*l*l*(.003971-.001529*l)))),o]};var c=r(24427),i=r(79989),u=r(94534),d=r(10219),f=r(24989),m=r(97254);let h={"004":"AF","008":"AL","012":"DZ","024":"AO","032":"AR","036":"AU","040":"AT","050":"BD","056":"BE","076":"BR",100:"BG",104:"MM",112:"BY",116:"KH",120:"CM",124:"CA",144:"LK",152:"CL",156:"CN",158:"TW",170:"CO",188:"CR",191:"HR",192:"CU",196:"CY",203:"CZ",208:"DK",214:"DO",218:"EC",818:"EG",233:"EE",231:"ET",246:"FI",250:"FR",276:"DE",288:"GH",300:"GR",320:"GT",344:"HK",348:"HU",352:"IS",356:"IN",360:"ID",364:"IR",368:"IQ",372:"IE",376:"IL",380:"IT",392:"JP",398:"KZ",400:"JO",404:"KE",408:"KP",410:"KR",414:"KW",422:"LB",434:"LY",440:"LT",442:"LU",458:"MY",484:"MX",504:"MA",508:"MZ",528:"NL",554:"NZ",566:"NG",578:"NO",586:"PK",604:"PE",608:"PH",616:"PL",620:"PT",634:"QA",642:"RO",643:"RU",682:"SA",686:"SN",688:"RS",702:"SG",703:"SK",704:"VN",705:"SI",710:"ZA",724:"ES",752:"SE",756:"CH",760:"SY",764:"TH",780:"TT",784:"AE",788:"TN",792:"TR",800:"UG",804:"UA",826:"GB",834:"TZ",840:"US",858:"UY",862:"VE",887:"YE",894:"ZM"},p={US:"United States",CA:"Canada",MX:"Mexico",BR:"Brazil",GB:"United Kingdom",FR:"France",DE:"Germany",IT:"Italy",ES:"Spain",NL:"Netherlands",BE:"Belgium",CH:"Switzerland",SE:"Sweden",NO:"Norway",DK:"Denmark",FI:"Finland",AT:"Austria",IE:"Ireland",PL:"Poland",CZ:"Czechia",HU:"Hungary",RU:"Russia",CN:"China",JP:"Japan",KR:"South Korea",TW:"Taiwan",IN:"India",SG:"Singapore",MY:"Malaysia",AU:"Australia",NZ:"New Zealand",IL:"Israel",TR:"Turkey",SA:"Saudi Arabia",IR:"Iran",ZA:"South Africa",UG:"Uganda",CM:"Cameroon",PE:"Peru"},y={US:[-98,39],CA:[-106,56],MX:[-102,23],BR:[-53,-10],GB:[-2,54],FR:[2,47],DE:[10,51],IT:[12,42],ES:[-4,40],NL:[5.3,52.1],BE:[4.5,50.8],CH:[8.2,46.8],SE:[15,62],NO:[8,61],DK:[10,56],FI:[26,64],AT:[14,47.5],IE:[-8,53.5],PL:[19,52],CZ:[15,50],HU:[19,47],RU:[40,55],CN:[104,35],JP:[138,36],KR:[128,36],TW:[121,24],IN:[79,22],SG:[104,1.3],MY:[102,4],AU:[134,-25],NZ:[174,-41],IL:[35,31.5],TR:[35,39],SA:[45,24],IR:[53,32],ZA:[25,-29],UG:[32,1],CM:[12,6],PE:[-75,-10]},x={US:"Americas",CA:"Americas",MX:"Americas",BR:"Americas",PE:"Americas",GB:"Europe",FR:"Europe",DE:"Europe",IT:"Europe",ES:"Europe",NL:"Europe",BE:"Europe",CH:"Europe",SE:"Europe",NO:"Europe",DK:"Europe",FI:"Europe",AT:"Europe",IE:"Europe",PL:"Europe",CZ:"Europe",HU:"Europe",RU:"Europe",CN:"East Asia",JP:"East Asia",KR:"East Asia",TW:"East Asia",IN:"South Asia",SG:"South Asia",MY:"South Asia",AU:"Oceania",NZ:"Oceania",IL:"Middle East",TR:"Middle East",SA:"Middle East",IR:"Middle East",ZA:"Africa",UG:"Africa",CM:"Africa"};function E(e){var t;let r=x[e];return r&&null!==(t=f.cu[r])&&void 0!==t?t:"#999999"}let v=["hsl(202, 70%, 94%)","hsl(202, 70%, 84%)","hsl(202, 70%, 74%)","hsl(202, 70%, 62%)","hsl(202, 70%, 50%)","hsl(202, 70%, 38%)"];function _(e){let{data:t,maxFlows:r=20}=e,_=(0,n.useRef)(null),[M,g]=(0,n.useState)(null),[A,S]=(0,n.useState)(null),[w,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{fetch("".concat("/patentworld","/geo/world-110m.json")).then(e=>e.json()).then(e=>g(e))},[]);let j=(0,n.useMemo)(()=>(0,l.Z)(s).scale(175.295).scale(160).translate([480,300]),[]),N=(0,n.useMemo)(()=>(0,c.Z)().projection(j),[j]),R=(0,n.useMemo)(()=>t.filter(e=>!!e.from_country&&!!e.to_country),[t]),k=(0,n.useMemo)(()=>{let e={};return R.forEach(t=>{e[t.from_country]=(e[t.from_country]||0)+t.flow_count,e[t.to_country]=(e[t.to_country]||0)+t.flow_count}),e},[R]),I=(0,n.useMemo)(()=>{let e=Object.values(k);return 0===e.length?(0,i.Z)().domain([0,1]).range(v):(0,i.Z)().domain([0,Math.max(...e)]).range(v)},[k]),L=(0,n.useMemo)(()=>{if(!M)return[];let e=M.objects.countries;return d.Z(M,e).features},[M]),O=(0,n.useMemo)(()=>R.filter(e=>y[e.from_country]&&y[e.to_country]).slice(0,r),[R,r]),U=(0,n.useMemo)(()=>0===O.length?1:Math.max(...O.map(e=>e.flow_count)),[O]),Z=(0,n.useMemo)(()=>{let e=Object.values(k);return 0===e.length?(0,u.Z)().domain([0,1]).range([2,8]):(0,u.Z)().domain([0,Math.max(...e)]).range([2.5,9])},[k]),B=(0,n.useMemo)(()=>{let e=new Set;return O.forEach(t=>{e.add(t.from_country),e.add(t.to_country)}),[...e].filter(e=>y[e])},[O]),T=(0,n.useMemo)(()=>B.map(e=>({code:e,total:k[e]||0})).sort((e,t)=>t.total-e.total).slice(0,10).map(e=>e.code),[B,k]),b=(0,n.useMemo)(()=>{let e=new Set;O.forEach(t=>{let r=[t.from_country,t.to_country].sort().join("-");e.add(r)});let t=new Set;return O.forEach(e=>{O.find(t=>t.from_country===e.to_country&&t.to_country===e.from_country)&&t.add([e.from_country,e.to_country].sort().join("-"))}),t},[O]),G=(0,n.useMemo)(()=>O.map(e=>{var t,r,o,n,l,s,c,i,u,d,f,m,h,p,x;let v=y[e.from_country],_=y[e.to_country];if(!v||!_)return null;let M=(t=v[0]*a.uR,r=v[1]*a.uR,o=_[0]*a.uR,n=_[1]*a.uR,l=(0,a.mC)(r),s=(0,a.O$)(r),c=(0,a.mC)(n),i=(0,a.O$)(n),u=l*(0,a.mC)(t),d=l*(0,a.O$)(t),f=c*(0,a.mC)(o),m=c*(0,a.O$)(o),h=2*(0,a.ZR)((0,a._b)((0,a.Jy)(n-r)+l*c*(0,a.Jy)(o-t))),p=(0,a.O$)(h),(x=h?function(e){var t=(0,a.O$)(e*=h)/p,r=(0,a.O$)(h-e)/p,o=r*u+t*f,n=r*d+t*m;return[(0,a.fv)(n,o)*a.RW,(0,a.fv)(r*s+t*i,(0,a._b)(o*o+n*n))*a.RW]}:function(){return[t*a.RW,r*a.RW]}).distance=h,x),g=[];for(let e=0;e<=60;e++){let t=j(M(e/60));t&&g.push(t)}if(g.length<2)return null;let A=[e.from_country,e.to_country].sort().join("-");if(b.has(A)){let t=e.from_country<e.to_country?3:-3;for(let e=0;e<g.length;e++){let r=g[Math.max(0,e-1)],o=g[Math.min(g.length-1,e+1)],n=o[0]-r[0],l=o[1]-r[1],a=Math.sqrt(n*n+l*l)||1;g[e]=[g[e][0]+-l/a*t,g[e][1]+n/a*t]}}let S="M".concat(g[0][0],",").concat(g[0][1]);for(let e=1;e<g.length;e++)S+=" L".concat(g[e][0],",").concat(g[e][1]);let w=Math.sqrt(e.flow_count/U),C=E(e.from_country),N=E(e.to_country);return{d:S,width:1.2+6*w,opacity:.25+.65*w,flow:e,from_country:e.from_country,to_country:e.to_country,color:C,destColor:N}}).filter(Boolean),[O,U,j,b]),P=(0,n.useCallback)((e,t)=>{let r=_.current;if(!r)return;let o=r.getBoundingClientRect(),n=k[t];if(null==n)return;let l=p[t]||t,a=(0,m.Py)(n);S({x:e.clientX-o.left,y:e.clientY-o.top-10,content:"".concat(l,": ").concat(a," inventor moves")}),C(t)},[k]),H=(0,n.useCallback)((e,t)=>{var r,o;let n=_.current;if(!n)return;let l=n.getBoundingClientRect(),a=p[null!==(r=t.from_country)&&void 0!==r?r:""]||t.from_country,s=p[null!==(o=t.to_country)&&void 0!==o?o:""]||t.to_country,c=(0,m.Py)(t.flow_count);S({x:e.clientX-l.left,y:e.clientY-l.top-10,content:"".concat(a," â†’ ").concat(s,": ").concat(c," moves")})},[]),K=(0,n.useCallback)(()=>{S(null),C(null)},[]);return M?(0,o.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[(0,o.jsxs)("div",{className:"flex-1 min-h-0 relative",children:[(0,o.jsxs)("svg",{ref:_,viewBox:"0 0 960 600",className:"w-full h-full",children:[(0,o.jsxs)("defs",{children:[Object.entries(f.cu).map(e=>{let[t,r]=e;return(0,o.jsx)("marker",{id:"arrow-".concat(t.replace(/\s/g,"-")),viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"4",markerHeight:"4",orient:"auto-start-reverse",children:(0,o.jsx)("path",{d:"M 0 2 L 8 5 L 0 8 Z",fill:r,fillOpacity:.8})},t)}),(0,o.jsx)("marker",{id:"arrow-default",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"4",markerHeight:"4",orient:"auto-start-reverse",children:(0,o.jsx)("path",{d:"M 0 2 L 8 5 L 0 8 Z",fill:"#999999",fillOpacity:.8})}),(0,o.jsxs)("filter",{id:"arc-glow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[(0,o.jsx)("feGaussianBlur",{stdDeviation:"2",result:"blur"}),(0,o.jsx)("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]}),G.map((e,t)=>{let r=y[e.from_country],n=y[e.to_country];if(!r||!n)return null;let l=j(r),a=j(n);return l&&a?(0,o.jsxs)("linearGradient",{id:"arc-grad-".concat(t),x1:l[0],y1:l[1],x2:a[0],y2:a[1],gradientUnits:"userSpaceOnUse",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:e.color}),(0,o.jsx)("stop",{offset:"100%",stopColor:e.destColor})]},"grad-".concat(t)):null})]}),L.map(e=>{var t;let r=h[String(e.id).padStart(3,"0")],n=r?k[r]:void 0,l=null!=n?I(n):"hsl(var(--muted) / 0.3)",a=w===r,s=w&&r&&O.some(e=>e.from_country===w&&e.to_country===r||e.to_country===w&&e.from_country===r),c=w&&!a&&!s&&null!=n;return(0,o.jsx)("path",{d:null!==(t=N(e))&&void 0!==t?t:"",fill:l,stroke:"hsl(var(--background))",strokeWidth:a?1.5:.5,opacity:c?.4:1,className:"cursor-pointer",style:{transition:"opacity 0.2s, stroke-width 0.2s"},onMouseMove:e=>r&&P(e,r),onMouseLeave:K},e.id)}),[...G].map((e,t)=>({arc:e,origIdx:t})).sort((e,t)=>e.arc.flow.flow_count-t.arc.flow.flow_count).map(e=>{var t;let{arc:r,origIdx:n}=e,l=w&&(r.from_country===w||r.to_country===w),a=null!==(t=x[r.from_country])&&void 0!==t?t:"default",s="arrow-".concat(a.replace(/\s/g,"-")),c=r.color!==r.destColor;return(0,o.jsx)("path",{d:r.d,fill:"none",stroke:c?"url(#arc-grad-".concat(n,")"):r.color,strokeWidth:l?1.5*r.width:r.width,strokeOpacity:w&&!l?.08:r.opacity,strokeLinecap:"round",markerEnd:"url(#".concat(s,")"),filter:l?"url(#arc-glow)":void 0,className:"cursor-pointer",style:{transition:"stroke-opacity 0.2s, stroke-width 0.2s"},onMouseMove:e=>H(e,r.flow),onMouseLeave:K},n)}),B.map(e=>{let t=y[e];if(!t)return null;let r=j(t);if(!r)return null;let n=Z(k[e]||0),l=w===e,a=w&&O.some(t=>t.from_country===w&&t.to_country===e||t.to_country===w&&t.from_country===e);return(0,o.jsx)("circle",{cx:r[0],cy:r[1],r:l?1.4*n:n,fill:"#0072B2",fillOpacity:!w||l||a?.85:.2,stroke:"hsl(var(--background))",strokeWidth:l?1.5:.8,className:"cursor-pointer",style:{transition:"r 0.2s, fill-opacity 0.2s"},onMouseMove:t=>P(t,e),onMouseLeave:K},e)}),T.map(e=>{let t=y[e];if(!t)return null;let r=j(t);if(!r)return null;let n=Z(k[e]||0);return(0,o.jsx)("text",{x:r[0],y:r[1]-n-3,textAnchor:"middle",fontSize:9,fontWeight:600,fill:"hsl(var(--foreground))",fillOpacity:.75,className:"pointer-events-none select-none",children:e},"label-".concat(e))})]}),A&&(0,o.jsx)("div",{className:"absolute pointer-events-none z-10 rounded-md border bg-card px-3 py-1.5 text-sm shadow-md",style:{left:A.x,top:A.y,transform:"translate(-50%, -100%)"},children:A.content})]}),(0,o.jsxs)("div",{className:"flex flex-col items-center gap-2 pt-4 pb-2 text-xs text-muted-foreground",children:[(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsx)("span",{children:"Low"}),v.map((e,t)=>(0,o.jsx)("div",{className:"w-6 h-3 rounded-sm border border-border/30",style:{backgroundColor:e}},t)),(0,o.jsx)("span",{children:"High"}),(0,o.jsx)("span",{className:"ml-1 opacity-70",children:"(total moves)"})]}),(0,o.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1",children:[(0,o.jsx)("span",{className:"font-medium",children:"Flow origin:"}),Object.entries(f.cu).map(e=>{let[t,r]=e;return(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsxs)("svg",{width:"20",height:"8",viewBox:"0 0 20 8",children:[(0,o.jsx)("line",{x1:"1",y1:"4",x2:"15",y2:"4",stroke:r,strokeWidth:"2",strokeLinecap:"round"}),(0,o.jsx)("polygon",{points:"15,1.5 20,4 15,6.5",fill:r,fillOpacity:.8})]}),(0,o.jsx)("span",{children:t})]},t)})]})]})]}):(0,o.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Loading map..."})}}}]);